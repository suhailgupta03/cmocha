<html>
    <head>
        <title>CMocha</title>
        <style type="text/css" media="screen">
            #editor { 
                position: absolute;
                top: 400;
                right: 400;
                bottom: 400;
                left: 400;
            }
        </style>
    </head>
    
    <body>
        <h3 class="center">CMocha</h3>
        <h5 id="connection_state"></h5>
        <div id="editor" class="mocha-editor"></div>
        <hr>
        <p class="messages_received">
            
        </p>
        
        <script type="text/javascript">
            var socketAddress = "127.0.0.1:8085";
            var ws = new WebSocket("ws://" + socketAddress);
            
            ws.onopen = function() {
                document.getElementById("connection_state").innerHTML = "You are connected";
                // Send the username when user is connected
                // This is required to attach the username to the server socket
                ws.send(JSON.stringify({"username" : "suhailgupta03@gmail.com"}));
            }
            
            ws.onclose = function() {
                document.getElementById("connection_state").innerHTML = "Disconnected";
            }
            
            ws.onmessage = function(payload) {
                var child = "<p>&#9787;&nbsp;" + payload.data + "</p>";
                document.getElementsByClassName("messages_received")[0].innerHTML += child;
            }
            
            ws.onerror = function(message) {
                 document.getElementById("connection_state").innerHTML = "Error occured while trying to connect " + socketAddress;
            }
            
            document.getElementsByClassName("mocha-editor")[0].onkeypress = function(event) {
                if(event.keyCode == 13) {
                    var messageObject = {
                      'lang' : 'java',
                      'source' : editor.getValue(),
                      'time_limit' : '',
                      'memory_limit' :''
                    };
                    var valToSend = JSON.stringify(messageObject); 
                    ws.send(valToSend);
                }
            }
        </script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js" type="text/javascript" charset="utf-8"></script>
        
        <script>
            var editor = ace.edit("editor");
            editor.setTheme("ace/theme/monokai");
            editor.getSession().setMode("ace/mode/java");
        </script>
    </body>
</html>
